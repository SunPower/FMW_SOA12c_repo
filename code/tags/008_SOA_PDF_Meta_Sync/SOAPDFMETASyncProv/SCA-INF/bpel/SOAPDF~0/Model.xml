<?xml version = '1.0' encoding = 'UTF-8'?>
<!--
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  Oracle JDeveloper BPEL Designer 
  
  Created: Wed Jul 25 16:02:31 IST 2012
  Author:  va35739
  Type: BPEL 1.1 Process
  Purpose: Asynchronous BPEL Process
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
--><process name="SOAPDFMETASyncProv_BPEL" targetNamespace="http://www.sunpowercorp.com/PDFFTPSalesforceT0042/SOAPDFMETASyncProv/SOAPDFMETASyncProv_BPEL" xmlns="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:client="http://www.sunpowercorp.com/PDFFTPSalesforceT0042/SOAPDFMETASyncProv/SOAPDFMETASyncProv_BPEL" xmlns:ora="http://schemas.oracle.com/xpath/extension" xmlns:bpelx="http://schemas.oracle.com/bpel/extension" xmlns:ns1="http://www.sunpowercorp.com/SunPowerApp/SFDCLogin/SFDCLogin_BPEL" xmlns:bpws="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:ns2="http://www.sunpowercorp.com/BOD/ProcessPDFFTPSalesForce/V1" xmlns:ns3="urn:partner.soap.sforce.com" xmlns:ns4="http://schemas.xmlsoap.org/ws/2003/03/addressing" xmlns:ns5="http://www.sunpowercorp.com/Verb/VerbCommonTypes/V1" xmlns:ns6="http://www.sunpowercorp.com/Noun/PDFFTPSalesForce/V1" xmlns:ns7="http://www.sunpowercorp.com/Common/PDFFTPSalesForceCommonTypes/V1" xmlns:ns8="http://xmlns.oracle.com/pcbpel/adapter/db/GetFTPDataDetailsDB" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:ns9="urn:sobject.partner.soap.sforce.com" xmlns:ns10="http://xmlns.oracle.com/pcbpel/adapter/ftp/PDFFTPSalesforceT0042/SOAPDFMETASyncProv/PutErrorFileToFTP" xmlns:ns11="http://xmlns.oracle.com/pcbpel/adapter/db/PDFFTPSalesforceT0042/SOAPDFMETASyncProv/UpdateFTPDetailsDB" xmlns:ns12="http://xmlns.oracle.com/pcbpel/adapter/db/UpdateFTPDetailsDB" xmlns:ns13="http://xmlns.oracle.com/pcbpel/adapter/ftp/PDFFTPSalesforceT0042/SOAPDFMETASyncProv/GetFileFTP" xmlns:ns14="http://xmlns.oracle.com/pcbpel/adapter/ftp/PDFFTPSalesforceT0042/SOAPDFMETASyncProv/GetPDFFileFTP" xmlns:ns15="http://xmlns.oracle.com/pcbpel/adapter/ftp/PDFFTPSalesforceT0042/SOAPDFMETASyncProv/PutPDFTomanyAttachFTP" xmlns:bpel2="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:xp20="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.Xpath20" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpm="http://xmlns.oracle.com/bpmn20/extensions" xmlns:oraext="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.ExtFunc" xmlns:dvm="http://www.oracle.com/XSL/Transform/java/oracle.tip.dvm.LookupValue" xmlns:hwf="http://xmlns.oracle.com/bpel/workflow/xpath" xmlns:ids="http://xmlns.oracle.com/bpel/services/IdentityService/xpath" xmlns:xdk="http://schemas.oracle.com/bpel/extension/xpath/function/xdk" xmlns:xref="http://www.oracle.com/XSL/Transform/java/oracle.tip.xref.xpath.XRefXPathFunctions" xmlns:ldap="http://schemas.oracle.com/xpath/extension/ldap" xmlns:ns16="http://xmlns.oracle.com/SOAUtilityServices/FTPFileMoveService/FTPFileMoveService" xmlns:ns17="http://www.sunpowercorp.com/SunPowerDevelopment/FTPFileMoveService/v1/xsd" xmlns:ns18="http://www.sunpowercorp.com/SunPowerApp/CommonErrorHandler/CommonErrorHandler_BPEL" xmlns:ns19="http://www.sunpowercorp.com/SunPowerDevelopment/utility/CommonErrorHandler/xsd/V1" xmlns:ns20="http://www.sunpowercorp.com/SOAUtilityServices/CommonLoggingService/CommonLoggingService_BPEL" xmlns:ns21="http://xmlns.oracle.com/testingapplication/CommonSFDCErrorLogService/CallCommSFDCErrMediator" xmlns:ns22="http://www.sunpowercorp.com/SOAUtilityServices/CommonSFDCErrorLogService/CommonSFDCErrorLogService_BPEL" xmlns:ns23="http://www.sunpowercorp.com/MergedSFDC" xmlns:ns24="http://www.sunpowercorp.com/MergedOracleSFDC" xmlns:ns25="http://www.sunpowercorp.com/MergedAttachmentSFDC" xmlns:ns26="http://www.sunpowercorp.com/MergedOracleAttachmentSFDC" id="BpPrc0">
    <!-- 
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        PARTNERLINKS                                                      
        List of services participating in this BPEL process               
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    -->
    <bpelx:annotation>
        <bpelx:analysis>
            <bpelx:property name="wsdlFile">
                SOAPDFMETASyncProv_BPEL.wsdl
            </bpelx:property>
        </bpelx:analysis>
    </bpelx:annotation>
    <partnerLinks>
        <!-- 
      The 'client' role represents the requester of this service. It is 
      used for callback. The location and correlation information associated
      with the client role are automatically set using WS-Addressing.
    -->
        <partnerLink name="soapdfmetasyncprov_bpel_client" partnerLinkType="client:SOAPDFMETASyncProv_BPEL" myRole="SOAPDFMETASyncProv_BPELProvider" partnerRole="SOAPDFMETASyncProv_BPELRequester"/>
        <partnerLink name="SDFCLoginService" partnerLinkType="ns1:SFDCLogin_BPEL" partnerRole="SFDCLogin_BPELProvider"/>
        <partnerLink name="SFDCService" partnerLinkType="ns3:Soap_PL" partnerRole="Soap_Role"/>
        <partnerLink name="UpdateFTPDetailsDB" partnerLinkType="ns11:UpdateFTPDetailsDB_plt" partnerRole="UpdateFTPDetailsDB_role"/>
        <partnerLink name="FTPFileMoveService" partnerLinkType="ns16:FTPFileMoveService" partnerRole="FTPFileMoveServiceProvider"/>
        <partnerLink name="CommonSFDCErrorLogService" partnerLinkType="ns21:CommonSFDCErrorLogService" partnerRole="execute_ptt"/>
    </partnerLinks>
    <!-- 
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        VARIABLES                                                        
        List of messages and XML documents used within this BPEL process 
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    -->
    <variables>
        <!-- Reference to the message passed as input during initiation -->
        <variable name="inputVariable" messageType="client:SOAPDFMETASyncProv_BPELRequestMessage"/>
        <!-- Reference to the message that will be sent back to the requester during callback -->
        <variable name="outputVariable" messageType="client:SOAPDFMETASyncProv_BPELResponseMessage"/>
        <variable name="InvokeSFDCLogin_InputVariable" messageType="ns1:SFDCLogin_BPELRequestMessage"/>
        <variable name="InvokeSFDCLogin_OutputVariable" messageType="ns1:SFDCLogin_BPELResponseMessage"/>
        <variable name="Header" messageType="ns3:Header"/>
        <variable name="CustomerNumber" type="xsd:string"/>
        <variable name="InvSFDCQuery_InputVariable" messageType="ns3:queryRequest"/>
        <variable name="InvSFDCQuery_OutputVariable" messageType="ns3:queryResponse"/>
        <variable name="IntCountofSFDCAccount" type="xsd:int"/>
        <variable name="UpdateFTPDetailsDB_IV" messageType="ns11:UpdateFTPDetailsDBInput_msg"/>
        <variable name="SFDC_ACCOUNT_ID" type="xsd:string"/>
        <variable name="SFDC_User_ID" type="xsd:string"/>
        <variable name="File_Name" type="xsd:string"/>
        <variable name="IntCountOfFoundAttachments" type="xsd:int"/>
        <variable name="Upsert_SDFC_InputVariable" messageType="ns3:upsertRequest"/>
        <variable name="Upsert_SDFC_OutputVariable" messageType="ns3:upsertResponse"/>
        <variable name="UpsertAttachID" type="xsd:string"/>
        <variable name="partnerReference" element="ns4:EndpointReference"/>
        <variable name="InvokeMovErrFTP_IV" messageType="ns16:FTPFileMoveServiceRequestMessage"/>
        <variable name="InvokeMovErrFTP_OV" messageType="ns16:FTPFileMoveServiceResponseMessage"/>
        <variable messageType="bpelx:RuntimeFaultMessage" name="FaultVar"/>
        <variable name="RenameFileName" type="xsd:string"/>
        <variable name="InvCommonSFDCErrorLogService_IV" messageType="ns21:requestMessage"/>
        <variable name="CommErr" messageType="ns21:requestMessage"/>
        <variable name="MergedSFDC" element="ns23:MergedSFDCRows"/>
        <variable name="MergeOracleSFDC" element="ns24:MergedOracleSFDCRows"/>
        <variable name="MergeAttachSFDC" element="ns25:MergedAttachmentSFDCRows"/>
        <variable name="MergeOrcAttacSFDC" element="ns26:MergedOracleAttachmentSFDCRows"/>
        <variable name="MovedFile" type="xsd:string"/>
        <variable name="SetTitle" type="xsd:string"/>
    </variables>
    <faultHandlers id="BpFhs0">
        <!--<catch faultName="bpelx:remoteFault" faultVariable="FaultVar">
            <sequence name="Sequence11">
                <assign name="AsgnFTPFileMoveParms">
                    <copy>
                        <from variable="RenameFileName"/>
                        <to variable="InvokeMovErrFTP_IV" part="payload"
                            query="/ns17:FileMoveReq/ns17:SourceFileName"/>
                    </copy>
                    <copy>
                        <from expression="'/home/ftpaccount/errorFiles'"/>
                        <to variable="InvokeMovErrFTP_IV" part="payload"
                            query="/ns17:FileMoveReq/ns17:TargetPhysicalDirectory"/>
                    </copy>
                    <copy>
                        <from variable="inputVariable" part="payload"
                              query="/ns2:ProcessPDFFTPSalesForce/ns2:DataArea/ns6:PDFSalesForce/ns6:PDFSalesForceDetails/ns7:SourceDirectoryPath"/>
                        <to variable="InvokeMovErrFTP_IV" part="payload"
                            query="/ns17:FileMoveReq/ns17:SourcePhysicalDirectory"/>
                    </copy>
                    <copy>
                        <from variable="File_Name"/>
                        <to variable="InvokeMovErrFTP_IV" part="payload"
                            query="/ns17:FileMoveReq/ns17:TargetFileName"/>
                    </copy>
                </assign>
                <invoke name="InvFTPFileMoveService"
                        inputVariable="InvokeMovErrFTP_IV"
                        outputVariable="InvokeMovErrFTP_OV"
                        partnerLink="FTPFileMoveService"
                        portType="ns16:FTPFileMoveService"
                        bpelx:invokeAsDetail="no" operation="process"/>
                <assign name="AsgnCommonErrorHandling">
                    <copy>
                        <from expression="ora:getCompositeInstanceId()"/>
                        <to variable="InvokeErrorHandSvc_IV" part="payload"
                            query="/ns19:CommonErrorHandlerInput/ns19:InstanceNumber"/>
                    </copy>
                    <copy>
                        <from variable="FaultVar" part="code"/>
                        <to variable="InvokeErrorHandSvc_IV" part="payload"
                            query="/ns19:CommonErrorHandlerInput/ns19:Fault/ns19:FaultCode"/>
                    </copy>
                    <copy>
                        <from variable="FaultVar" part="summary"/>
                        <to variable="InvokeErrorHandSvc_IV" part="payload"
                            query="/ns19:CommonErrorHandlerInput/ns19:Fault/ns19:FaultDescription"/>
                    </copy>
                    <copy>
                        <from variable="FaultVar" part="detail"/>
                        <to variable="InvokeErrorHandSvc_IV" part="payload"
                            query="/ns19:CommonErrorHandlerInput/ns19:Fault/ns19:FaultMessage"/>
                    </copy>
                    <copy>
                        <from expression='ora:getPreference("InterfaceNum")'/>
                        <to variable="InvokeErrorHandSvc_IV" part="payload"
                            query="/ns19:CommonErrorHandlerInput/ns19:InterfaceNumber"/>
                    </copy>
                    <copy>
                        <from expression='ora:getPreference("InterfaceName")'/>
                        <to variable="InvokeErrorHandSvc_IV" part="payload"
                            query="/ns19:CommonErrorHandlerInput/ns19:InterfaceName"/>
                    </copy>
                    <copy>
                        <from expression="'SOAPDFMETASyncProv'"/>
                        <to variable="InvokeErrorHandSvc_IV" part="payload"
                            query="/ns19:CommonErrorHandlerInput/ns19:ProcessName"/>
                    </copy>
                    <copy>
                        <from expression='ora:getPreference("OpenTicketSvc")'/>
                        <to variable="InvokeErrorHandSvc_IV" part="payload"
                            query="/ns19:CommonErrorHandlerInput/ns19:bOpenServiceTicket"/>
                    </copy>
                    <copy>
                        <from expression="'OracleEbiz'"/>
                        <to variable="InvokeErrorHandSvc_IV" part="payload"
                            query="/ns19:CommonErrorHandlerInput/ns19:FaultSystemName"/>
                    </copy>
                </assign>
                <invoke name="InvCommonErrorHandling"
                        inputVariable="InvokeErrorHandSvc_IV"
                        partnerLink="CommonErrorHandler"
                        portType="ns18:CommonErrorHandler_BPEL"
                        bpelx:invokeAsDetail="no" operation="process"/>
                <assign name="AsgnCommonLogging">
                    <copy>
                        <from expression="'E'"/>
                        <to variable="InvokeLoggSvc_IV" part="payload"
                            query="/ns20:Process/ns20:ProcessLog/ns20:status"/>
                    </copy>
                    <copy>
                        <from variable="File_Name"/>
                        <to variable="InvokeLoggSvc_IV" part="payload"
                            query="/ns20:Process/ns20:ProcessLog/ns20:uniqueIdentifier"/>
                    </copy>
                    <copy>
                        <from expression="'SOAPDFMETASyncProv'"/>
                        <to variable="InvokeLoggSvc_IV" part="payload"
                            query="/ns20:Process/ns20:ProcessLog/ns20:processname"/>
                    </copy>
                    <copy>
                        <from expression="ora:getCompositeInstanceId()"/>
                        <to variable="InvokeLoggSvc_IV" part="payload"
                            query="/ns20:Process/ns20:ProcessLog/ns20:instancenumber"/>
                    </copy>
                    <copy>
                        <from expression='ora:getPreference("InterfaceName")'/>
                        <to variable="InvokeLoggSvc_IV" part="payload"
                            query="/ns20:Process/ns20:ProcessLog/ns20:interfacename"/>
                    </copy>
                    <copy>
                        <from expression="'PDF101'"/>
                        <to variable="InvokeLoggSvc_IV" part="payload"
                            query="/ns20:Process/ns20:ProcessLog/ns20:interfacenumber"/>
                    </copy>
                </assign>
                <invoke name="InvCommonLogging"
                        inputVariable="InvokeLoggSvc_IV"
                        partnerLink="CommonLogging"
                        portType="ns20:CommonLoggingService_BPEL"
                        bpelx:invokeAsDetail="no" operation="process"/>
            </sequence>
        </catch>
        <catch faultName="bpelx:bindingFault" faultVariable="FaultVar">
            <sequence name="Sequence10">
             <assign name="AsgnFTPFileMoveParms">
                    <copy>
                        <from variable="RenameFileName"/>
                        <to variable="InvokeMovErrFTP_IV" part="payload"
                            query="/ns17:FileMoveReq/ns17:SourceFileName"/>
                    </copy>
                    <copy>
                        <from expression="'/home/ftpaccount/errorFiles'"/>
                        <to variable="InvokeMovErrFTP_IV" part="payload"
                            query="/ns17:FileMoveReq/ns17:TargetPhysicalDirectory"/>
                    </copy>
                    <copy>
                        <from variable="inputVariable" part="payload"
                              query="/ns2:ProcessPDFFTPSalesForce/ns2:DataArea/ns6:PDFSalesForce/ns6:PDFSalesForceDetails/ns7:SourceDirectoryPath"/>
                        <to variable="InvokeMovErrFTP_IV" part="payload"
                            query="/ns17:FileMoveReq/ns17:SourcePhysicalDirectory"/>
                    </copy>
                    <copy>
                        <from variable="File_Name"/>
                        <to variable="InvokeMovErrFTP_IV" part="payload"
                            query="/ns17:FileMoveReq/ns17:TargetFileName"/>
                    </copy>
                </assign>
                <invoke name="InvokeFTPFileMoveService"
                        inputVariable="InvokeMovErrFTP_IV"
                        outputVariable="InvokeMovErrFTP_OV"
                        partnerLink="FTPFileMoveService"
                        portType="ns16:FTPFileMoveService"
                        bpelx:invokeAsDetail="no" operation="process"/>
                <assign name="AsgnCommonErrorHandling">
                    <copy>
                        <from expression="ora:getCompositeInstanceId()"/>
                        <to variable="InvokeErrorHandSvc_IV" part="payload"
                            query="/ns19:CommonErrorHandlerInput/ns19:InstanceNumber"/>
                    </copy>
                    <copy>
                        <from variable="FaultVar" part="code"/>
                        <to variable="InvokeErrorHandSvc_IV" part="payload"
                            query="/ns19:CommonErrorHandlerInput/ns19:Fault/ns19:FaultCode"/>
                    </copy>
                    <copy>
                        <from variable="FaultVar" part="summary"/>
                        <to variable="InvokeErrorHandSvc_IV" part="payload"
                            query="/ns19:CommonErrorHandlerInput/ns19:Fault/ns19:FaultDescription"/>
                    </copy>
                    <copy>
                        <from variable="FaultVar" part="detail"/>
                        <to variable="InvokeErrorHandSvc_IV" part="payload"
                            query="/ns19:CommonErrorHandlerInput/ns19:Fault/ns19:FaultMessage"/>
                    </copy>
                    <copy>
                        <from expression="ora:getPreference('InterfaceNum')"/>
                        <to variable="InvokeErrorHandSvc_IV" part="payload"
                            query="/ns19:CommonErrorHandlerInput/ns19:InterfaceNumber"/>
                    </copy>
                    <copy>
                        <from expression="ora:getPreference('InterfaceName')"/>
                        <to variable="InvokeErrorHandSvc_IV" part="payload"
                            query="/ns19:CommonErrorHandlerInput/ns19:InterfaceName"/>
                    </copy>
                    <copy>
                        <from expression="'SOAPDFMETASyncProv'"/>
                        <to variable="InvokeErrorHandSvc_IV" part="payload"
                            query="/ns19:CommonErrorHandlerInput/ns19:ProcessName"/>
                    </copy>
                    <copy>
                        <from expression="ora:getPreference('OpenTicketSvc')"/>
                        <to variable="InvokeErrorHandSvc_IV" part="payload"
                            query="/ns19:CommonErrorHandlerInput/ns19:bOpenServiceTicket"/>
                    </copy>
                    <copy>
                        <from expression="'OracleEbiz'"/>
                        <to variable="InvokeErrorHandSvc_IV" part="payload"
                            query="/ns19:CommonErrorHandlerInput/ns19:FaultSystemName"/>
                    </copy>
                </assign>
                <invoke name="InvCommonErrorHandling"
                        inputVariable="InvokeErrorHandSvc_IV"
                        partnerLink="CommonErrorHandler"
                        portType="ns18:CommonErrorHandler_BPEL"
                        bpelx:invokeAsDetail="no" operation="process"/>
                <assign name="AsgnCommonLogging">
                    <copy>
                        <from expression="'E'"/>
                        <to variable="InvokeLoggSvc_IV" part="payload"
                            query="/ns20:Process/ns20:ProcessLog/ns20:status"/>
                    </copy>
                    <copy>
                        <from variable="File_Name"/>
                        <to variable="InvokeLoggSvc_IV" part="payload"
                            query="/ns20:Process/ns20:ProcessLog/ns20:uniqueIdentifier"/>
                    </copy>
                    <copy>
                        <from expression="'SOAPDFMETASyncProv'"/>
                        <to variable="InvokeLoggSvc_IV" part="payload"
                            query="/ns20:Process/ns20:ProcessLog/ns20:processname"/>
                    </copy>
                    <copy>
                        <from expression="ora:getCompositeInstanceId()"/>
                        <to variable="InvokeLoggSvc_IV" part="payload"
                            query="/ns20:Process/ns20:ProcessLog/ns20:instancenumber"/>
                    </copy>
                    <copy>
                        <from expression="'SOA_PDF_META_Sync'"/>
                        <to variable="InvokeLoggSvc_IV" part="payload"
                            query="/ns20:Process/ns20:ProcessLog/ns20:interfacename"/>
                    </copy>
                    <copy>
                          <from expression='ora:getPreference("InterfaceNum")'/>
                        <to variable="InvokeLoggSvc_IV" part="payload"
                            query="/ns20:Process/ns20:ProcessLog/ns20:interfacenumber"/>
                    </copy>
                </assign>
                <invoke name="InvCommonLogging"
                        inputVariable="InvokeLoggSvc_IV"
                        partnerLink="CommonLogging"
                        portType="ns20:CommonLoggingService_BPEL"
                        bpelx:invokeAsDetail="no" operation="process"/>
            </sequence>
        </catch> -->
        <catchAll id="BpCAl0">
            <sequence name="Sequence12" id="BpSeq0">
                <assign name="AsgnFTPFileMoveParms" id="BpAss0">
                    <copy>
                        <from variable="RenameFileName"/>
                        <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:SourceFileName"/>
                    </copy>
                    <copy>
                        <from expression="ora:getPreference(&quot;ErrorFilePath&quot;)"/>
                        <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:TargetPhysicalDirectory"/>
                    </copy>
                    <copy>
                        <from variable="inputVariable" part="payload" query="/ns2:ProcessPDFFTPSalesForce/ns2:DataArea/ns6:PDFSalesForce/ns6:PDFSalesForceDetails/ns7:SourceDirectoryPath"/>
                        <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:SourcePhysicalDirectory"/>
                    </copy>
                    <copy>
                        <from variable="File_Name"/>
                        <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:TargetFileName"/>
                    </copy>
                </assign>
                <invoke name="InvokeFTPFileMoveService" inputVariable="InvokeMovErrFTP_IV" outputVariable="InvokeMovErrFTP_OV" partnerLink="FTPFileMoveService" portType="ns16:FTPFileMoveService" bpelx:invokeAsDetail="no" operation="process" id="BpInv0"/>
                <assign name="AsgnCommonErrorHandler" id="BpAss1">
                    <copy>
                        <from expression="ora:getCompositeInstanceId()"/>
                        <to variable="CommErr" part="request" query="/ns22:CommonSFDCErrorLog/ns22:CommonErrorHandlerInputDetails/ns22:InstanceNumber"/>
                    </copy>
                    <copy>
                        <from expression="ora:getPreference(&quot;ProcessName&quot;)"/>
                        <to variable="CommErr" part="request" query="/ns22:CommonSFDCErrorLog/ns22:CommonErrorHandlerInputDetails/ns22:ProcessName"/>
                    </copy>
                    <copy>
                        <from expression="ora:getPreference(&quot;Severity&quot;)"/>
                        <to variable="CommErr" part="request" query="/ns22:CommonSFDCErrorLog/ns22:CommonErrorHandlerInputDetails/ns22:Severity"/>
                    </copy>
                    <copy>
                        <from expression="ora:getPreference(&quot;InterfaceNumber&quot;)"/>
                        <to variable="CommErr" part="request" query="/ns22:CommonSFDCErrorLog/ns22:CommonErrorHandlerInputDetails/ns22:InterfaceNumber"/>
                    </copy>
                    <copy>
                        <from expression="ora:getPreference(&quot;FaultCode&quot;)"/>
                        <to variable="CommErr" part="request" query="/ns22:CommonSFDCErrorLog/ns22:CommonErrorHandlerInputDetails/ns22:Fault/ns22:FaultCode"/>
                    </copy>
                    <copy>
                        <from expression="ora:getFaultAsString()"/>
                        <to variable="CommErr" part="request" query="/ns22:CommonSFDCErrorLog/ns22:CommonErrorHandlerInputDetails/ns22:Fault/ns22:FaultDescription"/>
                    </copy>
                    <copy>
                        <from expression="ora:getFaultName()"/>
                        <to variable="CommErr" part="request" query="/ns22:CommonSFDCErrorLog/ns22:CommonErrorHandlerInputDetails/ns22:Fault/ns22:FaultMessage"/>
                    </copy>
                    <copy>
                        <from expression="ora:getPreference(&quot;CorrectiveAction&quot;)"/>
                        <to variable="CommErr" part="request" query="/ns22:CommonSFDCErrorLog/ns22:CommonErrorHandlerInputDetails/ns22:CorrectiveAction"/>
                    </copy>
                    <copy>
                        <from expression="ora:getPreference(&quot;bOpenServiceTicket&quot;)"/>
                        <to variable="CommErr" part="request" query="/ns22:CommonSFDCErrorLog/ns22:CommonErrorHandlerInputDetails/ns22:bOpenServiceTicket"/>
                    </copy>
                    <copy>
                        <from expression="ora:getPreference(&quot;FaultSystemName&quot;)"/>
                        <to variable="CommErr" part="request" query="/ns22:CommonSFDCErrorLog/ns22:CommonErrorHandlerInputDetails/ns22:FaultSystemName"/>
                    </copy>
                    <copy>
                        <from expression="ora:getPreference(&quot;InterfaceName&quot;)"/>
                        <to variable="CommErr" part="request" query="/ns22:CommonSFDCErrorLog/ns22:CommonErrorHandlerInputDetails/ns22:InterfaceName"/>
                    </copy>
                     <copy>
                        <from expression="ora:getPreference(&quot;SendEmail&quot;)"/>
                        <to variable="CommErr" part="request" query="/ns22:CommonSFDCErrorLog/ns22:CommonErrorHandlerInputDetails/ns22:SendEmail"/>
                    </copy>
                    
                </assign>
                <assign name="TransformErrLogParms" id="BpAss2">
                    <bpelx:annotation>
                        <bpelx:pattern>transformation</bpelx:pattern>
                    </bpelx:annotation>
                    <copy>
                        <from expression="ora:doXSLTransformForDoc('Transformations/TransformErrLogParms.xsl', $CommErr.request)"/>
                        <to variable="InvCommonSFDCErrorLogService_IV" part="request"/>
                    </copy>
                </assign>
                <assign name="AssignFileName" id="BpAss3">
                    <copy>
                        <from variable="File_Name"/>
                        <to variable="InvCommonSFDCErrorLogService_IV" part="request" query="/ns22:CommonSFDCErrorLog/ns22:CommonErrorHandlerInputDetails/ns22:UniqueIdentNum/ns22:UniqueIdentifier"/>
                    </copy>
                </assign>
                <invoke name="InvCommonSFDCErrorLogService" inputVariable="InvCommonSFDCErrorLogService_IV" partnerLink="CommonSFDCErrorLogService" portType="ns21:execute_ptt" operation="execute" bpelx:invokeAsDetail="no" id="BpInv1"/>
                <!--<assign name="AsgnCommonLogging">
                    <copy>
                        <from expression="'E'"/>
                        <to variable="InvokeLoggSvc_IV" part="payload"
                            query="/ns20:Process/ns20:ProcessLog/ns20:status"/>
                    </copy>
                    <copy>
                        <from variable="File_Name"/>
                        <to variable="InvokeLoggSvc_IV" part="payload"
                            query="/ns20:Process/ns20:ProcessLog/ns20:uniqueIdentifier"/>
                    </copy>
                    <copy>
                        <from expression="'SOAPDFMETASyncProv'"/>
                        <to variable="InvokeLoggSvc_IV" part="payload"
                            query="/ns20:Process/ns20:ProcessLog/ns20:processname"/>
                    </copy>
                    <copy>
                        <from expression="ora:getCompositeInstanceId()"/>
                        <to variable="InvokeLoggSvc_IV" part="payload"
                            query="/ns20:Process/ns20:ProcessLog/ns20:instancenumber"/>
                    </copy>
                    <copy>
                        <from expression="ora:getPreference('InterfaceName')"/>
                        <to variable="InvokeLoggSvc_IV" part="payload"
                            query="/ns20:Process/ns20:ProcessLog/ns20:interfacename"/>
                    </copy>
                    <copy>
                         <from expression="ora:getPreference('InterfaceNum')"/>
                        <to variable="InvokeLoggSvc_IV" part="payload"
                            query="/ns20:Process/ns20:ProcessLog/ns20:interfacenumber"/>
                    </copy>
                </assign>
                <invoke name="InvCommonLogging"
                        inputVariable="InvokeLoggSvc_IV"
                        partnerLink="CommonLogging"
                        portType="ns20:CommonLoggingService_BPEL"
                        bpelx:invokeAsDetail="no" operation="process"/> -->
                <terminate name="Terminate" id="BpTer0"/>
            </sequence>
        </catchAll>
    </faultHandlers>
    <!-- 
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
       ORCHESTRATION LOGIC                                               
       Set of activities coordinating the flow of messages across the    
       services integrated within this business process                  
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    -->
    <sequence name="main" id="BpSeq1">
        <!-- Receive input from requestor. (Note: This maps to operation defined in SOAPDFMETASyncProv_BPEL.wsdl) -->
        <receive name="receiveInput" partnerLink="soapdfmetasyncprov_bpel_client" portType="client:SOAPDFMETASyncProv_BPEL" operation="process" variable="inputVariable" createInstance="yes" id="BpRcv0"/>
        <assign name="AssignSetTitle" id="BpAss4">
            <copy>
                <from expression="substring-before(bpws:getVariableData('inputVariable','payload','/ns2:ProcessPDFFTPSalesForce/ns2:DataArea/ns6:PDFSalesForce/ns6:PDFSalesForceDetails/ns7:PDF_FILE_NAME'),'.s')"/>
                <to variable="SetTitle"/>
            </copy>
            <copy>
                <from expression="oraext:setFlowInstanceTitle(concat('FileNameProv:',bpws:getVariableData('SetTitle')))"/>
                <to variable="SetTitle"/>
            </copy>
			 <copy>
                <from expression="substring-before(bpws:getVariableData('inputVariable','payload','/ns2:ProcessPDFFTPSalesForce/ns2:DataArea/ns6:PDFSalesForce/ns6:PDFSalesForceDetails/ns7:PDF_FILE_NAME'),'.s')"/>
                <to variable="File_Name"/>
            </copy>
			 <copy>
                <from expression="bpws:getVariableData('inputVariable','payload','/ns2:ProcessPDFFTPSalesForce/ns2:DataArea/ns6:PDFSalesForce/ns6:PDFSalesForceDetails/ns7:PDF_FILE_NAME')"/>
                <to variable="RenameFileName"/>
            </copy>
        </assign>
        <invoke name="InvokeSFDCLogin" bpelx:invokeAsDetail="no" inputVariable="InvokeSFDCLogin_InputVariable" outputVariable="InvokeSFDCLogin_OutputVariable" partnerLink="SDFCLoginService" portType="ns1:SFDCLogin_BPEL" operation="process" id="BpInv2"/>
        <assign name="AssignSessionHeaderID" id="BpAss5">
            <copy>
                <from variable="InvokeSFDCLogin_OutputVariable" part="payload" query="/ns1:SFDCLoginResp/ns1:sessionId"/>
                <to variable="Header" part="SessionHeader" query="/ns3:SessionHeader/ns3:sessionId"/>
            </copy>
        </assign>
        <assign name="AsgnPartnerReference" id="BpAss6">
            <copy>
                <from><EndpointReference xmlns="http://schemas.xmlsoap.org/ws/2003/03/addressing">
                        <Address/>
                    </EndpointReference></from>
                <to variable="partnerReference"/>
            </copy>
            <copy>
                <from variable="InvokeSFDCLogin_OutputVariable" part="payload" query="/ns1:SFDCLoginResp/ns1:serverUrl"/>
                <to variable="partnerReference" query="/ns4:EndpointReference/ns4:Address"/>
            </copy>
            <copy>
                <from variable="partnerReference"/>
                <to partnerLink="SFDCService"/>
            </copy>
        </assign>
        <assign name="AsgnSFDCQuery" id="BpAss7">
           
           
            <copy>
                <from expression="substring-after(bpws:getVariableData('inputVariable','payload','/ns2:ProcessPDFFTPSalesForce/ns2:DataArea/ns6:PDFSalesForce/ns6:PDFSalesForceDetails/ns7:PDF_FILE_NAME'),'_')"/>
                <to variable="CustomerNumber"/>
            </copy>
            <copy>
                <from expression="substring-before(bpws:getVariableData('CustomerNumber'),'_')"/>
                <to variable="CustomerNumber"/>
            </copy>
            <copy>
                <from expression="concat(&quot;select a.Id, a.Name, a.Oracle_Account_Number__c from Account a where Oracle_Account_Number__c =&quot;,&quot;'&quot;,bpws:getVariableData('CustomerNumber'),&quot;'&quot; )"/>
                <to variable="InvSFDCQuery_InputVariable" part="parameters" query="/ns3:query/ns3:queryString"/>
            </copy>
        </assign>
        <invoke name="InvSFDCQuery" inputVariable="InvSFDCQuery_InputVariable" outputVariable="InvSFDCQuery_OutputVariable" partnerLink="SFDCService" portType="ns3:Soap" operation="query" bpelx:invokeAsDetail="no" bpelx:inputHeaderVariable="Header" id="BpInv3"/>
        <assign name="TransformMergedSFDC" id="BpAss8">
            <bpelx:annotation>
                <bpelx:pattern>transformation</bpelx:pattern>
            </bpelx:annotation>
            <copy>
                <from expression="ora:doXSLTransformForDoc('Transformations/TransMergedSFDC.xsl', $InvSFDCQuery_OutputVariable.parameters, 'InvokeSFDCLogin_OutputVariable.payload', $InvokeSFDCLogin_OutputVariable.payload)"/>
                <to variable="MergedSFDC"/>
            </copy>
        </assign>
        <assign name="AssignSFDCAccCount" id="BpAss9">
            <copy>
                <from expression="count(bpws:getVariableData('InvSFDCQuery_OutputVariable','parameters','/ns3:queryResponse/ns3:result/ns3:records/ns9:Id'))"/>
                <to variable="IntCountofSFDCAccount"/>
            </copy>
        </assign>
        <switch name="FirstIFSwitchCond" id="BpSwt0">
            <case condition="bpws:getVariableData('IntCountofSFDCAccount') >= 1">
                <sequence name="Sequence1" id="BpSeq2">
                    <assign name="TransMergedOrcSFDC" id="BpAss10">
                        <bpelx:annotation>
                            <bpelx:pattern>transformation</bpelx:pattern>
                        </bpelx:annotation>
                        <copy>
                            <from expression="ora:doXSLTransformForDoc('Transformations/TransMergedOracleSFDC.xsl', $MergedSFDC, 'inputVariable.payload', $inputVariable.payload)"/>
                            <to variable="MergeOracleSFDC"/>
                        </copy>
                    </assign>
                    <assign name="AsgnAttachSFDCQuery" id="BpAss11">
                        <copy>
                            <from variable="MergeOracleSFDC" query="/ns24:MergedOracleSFDCRows/ns24:row/ns24:SFDC_ACCOUNT_ID"/>
                            <to variable="SFDC_ACCOUNT_ID"/>
                        </copy>
                        <copy>
                            <from variable="MergeOracleSFDC" query="/ns24:MergedOracleSFDCRows/ns24:row/ns24:SFDC_USER_ID"/>
                            <to variable="SFDC_User_ID"/>
                        </copy>
                       
                        <copy>
                            <from expression="concat(&quot;select a.Id,a.ParentId,a.Name,a.IsPrivate,a.ContentType,a.OwnerId from Attachment a where a.IsDeleted = false and a.ParentId ='&quot;,bpws:getVariableData('SFDC_ACCOUNT_ID'),&quot;'&quot;,&quot; and a.OwnerId =&quot;,&quot;'&quot;,bpws:getVariableData('SFDC_User_ID'),&quot;'&quot;,&quot;and a.Name =&quot;,&quot;'&quot;,bpws:getVariableData('File_Name'),&quot;'&quot;)"/>
                            <to variable="InvSFDCQuery_InputVariable" part="parameters" query="/ns3:query/ns3:queryString"/>
                        </copy>
                    </assign>
                    <invoke name="InvokeAttachQuery" inputVariable="InvSFDCQuery_InputVariable" outputVariable="InvSFDCQuery_OutputVariable" partnerLink="SFDCService" portType="ns3:Soap" operation="query" bpelx:invokeAsDetail="no" bpelx:inputHeaderVariable="Header" id="BpInv4"/>
                    <assign name="TransMergeAttachSFDC" id="BpAss12">
                        <bpelx:annotation>
                            <bpelx:pattern>transformation</bpelx:pattern>
                        </bpelx:annotation>
                        <copy>
                            <from expression="ora:doXSLTransformForDoc('Transformations/TransMergeAttachSFDC.xsl', $InvSFDCQuery_OutputVariable.parameters)"/>
                            <to variable="MergeAttachSFDC"/>
                        </copy>
                    </assign>
                    <assign name="AssignCountOfAttachments" id="BpAss13">
                        <copy>
                            <from expression="count(bpws:getVariableData('InvSFDCQuery_OutputVariable','parameters','/ns3:queryResponse/ns3:result/ns3:records/ns9:Name'))"/>
                            <to variable="IntCountOfFoundAttachments"/>
                        </copy>
                    </assign>
                    <switch name="SecndIFSwitchCond" id="BpSwt1">
                        <case condition="bpws:getVariableData('IntCountOfFoundAttachments') =1">
                            <sequence name="Sequence4" id="BpSeq3">
                                <assign name="TransMergeOrcAttachment" id="BpAss14">
                                    <bpelx:annotation>
                                        <bpelx:pattern>transformation</bpelx:pattern>
                                    </bpelx:annotation>
                                    <copy>
                                        <from expression="ora:doXSLTransformForDoc('Transformations/TransMergeOrcAttacSFDC.xsl', $MergeOracleSFDC, 'MergeAttachSFDC', $MergeAttachSFDC)"/>
                                        <to variable="MergeOrcAttacSFDC"/>
                                    </copy>
                                </assign>
                                <assign name="TransformAttachUpsertParms" id="BpAss15">
                                    <bpelx:annotation>
                                        <bpelx:pattern>transformation</bpelx:pattern>
                                    </bpelx:annotation>
                                    <copy>
                                        <from expression="ora:doXSLTransformForDoc('Transformations/TransAttachUpsertSFDC.xsl', $MergeOrcAttacSFDC)"/>
                                        <to variable="Upsert_SDFC_InputVariable" part="parameters"/>
                                    </copy>
                                </assign>
                                <assign name="AssgnFileContent" id="BpAss16">
                                    <copy>
                                        <from variable="inputVariable" part="payload" query="/ns2:ProcessPDFFTPSalesForce/ns2:DataArea/ns6:PDFSalesForce/ns6:PDFSalesForceDetails/ns7:Body"/>
                                        <to variable="Upsert_SDFC_InputVariable" part="parameters" query="/ns3:upsert/ns3:sObjects/ns9:Body"/>
                                    </copy>
                                </assign>
                                <!--    <assign name="Assign1">
                                    <copy>
                                        <from expression="'Attachment'"/>
                                        <to variable="Upsert_SDFC_InputVariable"
                                            part="parameters"
                                            query="/ns3:upsert/ns3:sObjects/ns9:type"/>
                                    </copy>
                                    <copy>
                                        <from expression="'application/pdf'"/>
                                        <to variable="Upsert_SDFC_InputVariable"
                                            part="parameters"
                                            query="/ns3:upsert/ns3:sObjects/ns9:ContentType"/>
                                    </copy>
                                    <copy>
                                        <from expression="bpws:getVariableData('CommnMergeSchma','payload','/ns2:ProcessPDFFTPSalesForce/ns2:DataArea/ns6:PDFSalesForce/ns6:PDFSalesForceDetails/ns7:SFDC_ATTACHMENT_ID')"/>
                                        <to variable="Upsert_SDFC_InputVariable"
                                            part="parameters"
                                            query="/ns3:upsert/ns3:sObjects/ns9:Id"/>
                                    </copy>
                                </assign> -->
                                <!--   <assign name="Transform1">
                                    <bpelx:annotation>
                                        <bpelx:pattern>transformation</bpelx:pattern>
                                    </bpelx:annotation>
                                    <copy>
                                        <from expression="ora:doXSLTransformForDoc('xsl/Transformation_1.xsl', $InvSFDCQuery_OutputVariable.parameters)"/>
                                        <to variable="Upsert_SDFC_InputVariable"
                                            part="parameters"/>
                                    </copy>
                                </assign> -->
                                <invoke name="InvokeAttachUpsertSFDC" inputVariable="Upsert_SDFC_InputVariable" outputVariable="Upsert_SDFC_OutputVariable" partnerLink="SFDCService" portType="ns3:Soap" operation="upsert" bpelx:invokeAsDetail="no" bpelx:inputHeaderVariable="Header" id="BpInv5"/>
                                <switch name="ThirdIFSwitchCond" id="BpSwt2">
                                    <case condition="contains(bpws:getVariableData('Upsert_SDFC_OutputVariable','parameters','/ns3:upsertResponse/ns3:result/ns3:success'),'true')">
                                        <sequence id="BpSeq4">
                                            <assign name="TransOrcAttacgSFDCUpsertParms" id="BpAss17">
                                                <bpelx:annotation>
                                                    <bpelx:pattern>transformation</bpelx:pattern>
                                                </bpelx:annotation>
                                                <copy>
                                                    <from expression="ora:doXSLTransformForDoc('Transformations/TransOrcAtachSFDCUpsert.xsl', $MergeOrcAttacSFDC)"/>
                                                    <to variable="Upsert_SDFC_InputVariable" part="parameters"/>
                                                </copy>
                                            </assign>
                                         <!--   <assign name="XformTransUpsertParms">
                                                <bpelx:annotation>
                                                    <bpelx:pattern>transformation</bpelx:pattern>
                                                </bpelx:annotation>
                                                <copy>
                                                    <from expression="ora:doXSLTransformForDoc('xsl/TransUpsertTransSFDC.xsl', $MergeOrcAttacSFDC)"/>
                                                    <to variable="SOA2TransactionDetails__c_upsert_IV"
                                                        part="parameters"/>
                                                </copy>
                                            </assign>  -->
                                            <invoke name="InvTransUpsertSFDC" partnerLink="SFDCService" portType="ns3:Soap" operation="upsert" inputVariable="Upsert_SDFC_InputVariable" outputVariable="Upsert_SDFC_OutputVariable" bpelx:invokeAsDetail="no" bpelx:inputHeaderVariable="Header" id="BpInv6"/>
                                        </sequence>
                                    </case>
                                    <otherwise>
                                        <sequence name="Sequence5" id="BpSeq5">
                                         <assign name="AssignMoveftpData" id="BpAss18">
                                            <copy>
                                                <from variable="RenameFileName"/>
                                                <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:SourceFileName"/>
                                            </copy>
                                            <copy>
                                                <from variable="File_Name"/>
                                                <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:TargetFileName"/>
                                            </copy>
                                            <copy>
                                                <from variable="inputVariable" part="payload" query="/ns2:ProcessPDFFTPSalesForce/ns2:DataArea/ns6:PDFSalesForce/ns6:PDFSalesForceDetails/ns7:SourceDirectoryPath"/>
                                                <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:SourcePhysicalDirectory"/>
                                            </copy>
                                            <copy>
                                               <from expression="ora:getPreference(&quot;Fail2UpsertAttach&quot;)"/>
                                                <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:TargetPhysicalDirectory"/>
                                            </copy>
                                        </assign>
                                        <invoke name="InvFTPFileMoveService" inputVariable="InvokeMovErrFTP_IV" outputVariable="InvokeMovErrFTP_OV" partnerLink="FTPFileMoveService" portType="ns16:FTPFileMoveService" bpelx:invokeAsDetail="no" operation="process" id="BpInv7"/>
                                            <assign name="AssignAttachFailUpd" id="BpAss19">
                                                <copy>
                                                    <from variable="File_Name"/>
                                                    <to variable="UpdateFTPDetailsDB_IV" part="UpdateFTPDetailsDBInput_msg" query="/ns12:UpdateFTPDetailsDBInput/ns12:PDF_FILE_NAME"/>
                                                </copy>
                                                <copy>
                                                    <from expression="'Failed to update attachment in SFDC'"/>
                                                    <to variable="UpdateFTPDetailsDB_IV" part="UpdateFTPDetailsDBInput_msg" query="/ns12:UpdateFTPDetailsDBInput/ns12:ERROR_MESSAGE"/>
                                                </copy>
                                                <copy>
                                                    <from expression="'ERROR'"/>
                                                    <to variable="UpdateFTPDetailsDB_IV" part="UpdateFTPDetailsDBInput_msg" query="/ns12:UpdateFTPDetailsDBInput/ns12:RECORD_STATUS"/>
                                                </copy>
                                                <copy>
                                                    <from expression="'Y'"/>
                                                    <to variable="MovedFile"/>
                                                </copy>
                                            </assign>
                                            <invoke name="InvokeUpdDB" bpelx:invokeAsDetail="no" inputVariable="UpdateFTPDetailsDB_IV" partnerLink="UpdateFTPDetailsDB" portType="ns11:UpdateFTPDetailsDB_ptt" operation="UpdateFTPDetailsDB" id="BpInv8"/>
                                        </sequence>
                                    </otherwise>
                                </switch>
                            </sequence>
                        </case>
                        <otherwise>
                            <switch name="ElseIFSwitchCond" id="BpSwt3">
                                <case condition="bpws:getVariableData('IntCountOfFoundAttachments') >1">
                                    <sequence name="Sequence2" id="BpSeq6">
                                        <assign name="AssignMoveftpData" id="BpAss20">
                                            <copy>
                                                <from variable="RenameFileName"/>
                                                <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:SourceFileName"/>
                                            </copy>
                                            <copy>
                                                <from variable="File_Name"/>
                                                <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:TargetFileName"/>
                                            </copy>
                                            <copy>
                                                <from variable="inputVariable" part="payload" query="/ns2:ProcessPDFFTPSalesForce/ns2:DataArea/ns6:PDFSalesForce/ns6:PDFSalesForceDetails/ns7:SourceDirectoryPath"/>
                                                <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:SourcePhysicalDirectory"/>
                                            </copy>
                                            <copy>
                                                <from expression="ora:getPreference(&quot;TooManyAttachPath&quot;)"/>
                                                <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:TargetPhysicalDirectory"/>
                                            </copy>
                                        </assign>
                                        <invoke name="InvFTPFileMoveService" inputVariable="InvokeMovErrFTP_IV" outputVariable="InvokeMovErrFTP_OV" partnerLink="FTPFileMoveService" portType="ns16:FTPFileMoveService" bpelx:invokeAsDetail="no" operation="process" id="BpInv9"/>
                                        <assign name="AssignTomanyattachDB" id="BpAss21">
                                            <copy>
                                                <from expression="'ERROR'"/>
                                                <to variable="UpdateFTPDetailsDB_IV" part="UpdateFTPDetailsDBInput_msg" query="/ns12:UpdateFTPDetailsDBInput/ns12:RECORD_STATUS"/>
                                            </copy>
                                            <copy>
                                                <from expression="'Too many attachements found for this PDF name'"/>
                                                <to variable="UpdateFTPDetailsDB_IV" part="UpdateFTPDetailsDBInput_msg" query="/ns12:UpdateFTPDetailsDBInput/ns12:ERROR_MESSAGE"/>
                                            </copy>
                                            <copy>
                                                <from variable="File_Name"/>
                                                <to variable="UpdateFTPDetailsDB_IV" part="UpdateFTPDetailsDBInput_msg" query="/ns12:UpdateFTPDetailsDBInput/ns12:PDF_FILE_NAME"/>
                                            </copy>
                                            <copy>
                                                <from expression="'Y'"/>
                                                <to variable="MovedFile"/>
                                            </copy>
                                        </assign>
                                        <invoke name="InvokeUpdDB" bpelx:invokeAsDetail="no" inputVariable="UpdateFTPDetailsDB_IV" partnerLink="UpdateFTPDetailsDB" portType="ns11:UpdateFTPDetailsDB_ptt" operation="UpdateFTPDetailsDB" id="BpInv10"/>
                                    </sequence>
                                </case>
                                <otherwise>
                                    <sequence name="Sequence8" id="BpSeq7">
                                        <assign name="TransUpsertAttacSFDC" id="BpAss22">
                                            <bpelx:annotation>
                                                <bpelx:pattern>transformation</bpelx:pattern>
                                            </bpelx:annotation>
                                            <copy>
                                                <from expression="ora:doXSLTransformForDoc('Transformations/XformAttUpsertSFDC.xsl', $MergeOracleSFDC)"/>
                                                <to variable="Upsert_SDFC_InputVariable" part="parameters"/>
                                            </copy>
                                        </assign>
                                        <assign name="AssignFileContent" id="BpAss23">
                                            <copy>
                                                <from variable="File_Name"/>
                                                <to variable="Upsert_SDFC_InputVariable" part="parameters" query="/ns3:upsert/ns3:sObjects/ns9:Name"/>
                                            </copy>
                                            <copy>
                                                <from variable="inputVariable" part="payload" query="/ns2:ProcessPDFFTPSalesForce/ns2:DataArea/ns6:PDFSalesForce/ns6:PDFSalesForceDetails/ns7:Body"/>
                                                <to variable="Upsert_SDFC_InputVariable" part="parameters" query="/ns3:upsert/ns3:sObjects/ns9:Body"/>
                                            </copy>
                                        </assign>
                                        <invoke name="InvokeAttcUpsertSFDC" bpelx:invokeAsDetail="no" inputVariable="Upsert_SDFC_InputVariable" outputVariable="Upsert_SDFC_OutputVariable" partnerLink="SFDCService" portType="ns3:Soap" operation="upsert" bpelx:inputHeaderVariable="Header" id="BpInv11"/>
                                        <assign name="AssignUpsertAttID" id="BpAss24">
                                            <copy>
                                                <from variable="Upsert_SDFC_OutputVariable" part="parameters" query="/ns3:upsertResponse/ns3:result/ns3:id"/>
                                                <to variable="UpsertAttachID"/>
                                            </copy>
                                        </assign>
                                        <switch name="ElseIF2SwitchCond" id="BpSwt4">
                                            <case condition="contains(bpws:getVariableData('Upsert_SDFC_OutputVariable','parameters','/ns3:upsertResponse/ns3:result/ns3:success'),'true')">
                                                <sequence name="Sequence9" id="BpSeq8">
                                                    <assign name="TransOrcSFDCParms" id="BpAss25">
                                                        <bpelx:annotation>
                                                            <bpelx:pattern>transformation</bpelx:pattern>
                                                        </bpelx:annotation>
                                                        <copy>
                                                            <from expression="ora:doXSLTransformForDoc('Transformations/TransOrcSFDCTransUpsert.xsl', $MergeOracleSFDC, 'Upsert_SDFC_OutputVariable.parameters', $Upsert_SDFC_OutputVariable.parameters)"/>
                                                            <to variable="Upsert_SDFC_InputVariable" part="parameters"/>
                                                        </copy>
                                                    </assign>
                                                    <!-- <assign name="TransUpsertTransSFDC">
                                                        <bpelx:annotation>
                                                            <bpelx:pattern>transformation</bpelx:pattern>
                                                        </bpelx:annotation>
                                                        <copy>
                                                            <from expression="ora:doXSLTransformForDoc('xsl/TransUpsTransatSFDC.xsl', $MergeOracleSFDC)"/>
                                                            <to variable="SOA2TransactionDetails__c_upsert_IV"
                                                                part="parameters"/>
                                                        </copy>
                                                    </assign> -->
                                                 <!--   <assign name="AssignUpsertAttID">
                                                        <copy>
                                                            <from variable="UpsertAttachID"/>
                                                            <to variable="Upsert_SDFC_InputVariable"
                                                                part="parameters"
                                                                query="/ns3:upsert/ns3:sObjects/ns9:Attachment_Id__c"/>
                                                        </copy>
                                                    </assign> -->
                                                    <invoke name="InvokeTrnsUpsertSFDC" inputVariable="Upsert_SDFC_InputVariable" outputVariable="Upsert_SDFC_OutputVariable" partnerLink="SFDCService" portType="ns3:Soap" operation="upsert" bpelx:invokeAsDetail="no" bpelx:inputHeaderVariable="Header" id="BpInv12"/>
                                                </sequence>
                                            </case>
                                            <otherwise>
                                                <sequence name="Sequence3" id="BpSeq9">
                                                    <assign name="AssignMoveFTP" id="BpAss26">
                                                        <copy>
                                                            <from variable="RenameFileName"/>
                                                            <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:SourceFileName"/>
                                                        </copy>
                                                        <copy>
                                                            <from variable="File_Name"/>
                                                            <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:TargetFileName"/>
                                                        </copy>
                                                        <copy>
                                                            <from variable="inputVariable" part="payload" query="/ns2:ProcessPDFFTPSalesForce/ns2:DataArea/ns6:PDFSalesForce/ns6:PDFSalesForceDetails/ns7:SourceDirectoryPath"/>
                                                            <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:SourcePhysicalDirectory"/>
                                                        </copy>
                                                        <copy> 
                                                              <from expression="ora:getPreference(&quot;Fail2UpsertAttach&quot;)"/>
                                                            <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:TargetPhysicalDirectory"/>
                                                        </copy>
                                                    </assign>
                                                    <invoke name="InvFTPFileMoveService" inputVariable="InvokeMovErrFTP_IV" outputVariable="InvokeMovErrFTP_OV" partnerLink="FTPFileMoveService" portType="ns16:FTPFileMoveService" operation="process" bpelx:invokeAsDetail="no" id="BpInv13"/>
                                                    <assign name="AssignFailedUpsertDB" id="BpAss27">
                                                        <copy>
                                                            <from expression="'ERROR'"/>
                                                            <to variable="UpdateFTPDetailsDB_IV" part="UpdateFTPDetailsDBInput_msg" query="/ns12:UpdateFTPDetailsDBInput/ns12:RECORD_STATUS"/>
                                                        </copy>
                                                        <copy>
                                                            <from expression="'Failed to upsert attachment in SFDC'"/>
                                                            <to variable="UpdateFTPDetailsDB_IV" part="UpdateFTPDetailsDBInput_msg" query="/ns12:UpdateFTPDetailsDBInput/ns12:ERROR_MESSAGE"/>
                                                        </copy>
                                                        <copy>
                                                            <from variable="File_Name"/>
                                                            <to variable="UpdateFTPDetailsDB_IV" part="UpdateFTPDetailsDBInput_msg" query="/ns12:UpdateFTPDetailsDBInput/ns12:PDF_FILE_NAME"/>
                                                        </copy>
                                                        <copy>
                                                            <from expression="'Y'"/>
                                                            <to variable="MovedFile"/>
                                                        </copy>
                                                    </assign>
                                                    <invoke name="InvokeUpdDB" bpelx:invokeAsDetail="no" inputVariable="UpdateFTPDetailsDB_IV" partnerLink="UpdateFTPDetailsDB" portType="ns11:UpdateFTPDetailsDB_ptt" operation="UpdateFTPDetailsDB" id="BpInv14"/>
                                                </sequence>
                                            </otherwise>
                                        </switch>
                                    </sequence>
                                </otherwise>
                            </switch>
                        </otherwise>
                    </switch>
                    <switch name="FourthIFSwitchCond" id="BpSwt5">
                        <case condition="bpws:getVariableData('MovedFile')= 'Y'">
                            <empty name="Continue" id="BpEmp0"/>
                        </case>
                        <case condition="contains(bpws:getVariableData('Upsert_SDFC_OutputVariable','parameters','/ns3:upsertResponse/ns3:result/ns3:success'),'true')">
                            <sequence name="Sequence6" id="BpSeq10">
                                <assign name="AssignSucFTP" id="BpAss28">
                                    <copy>
                                        <from variable="RenameFileName"/>
                                        <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:SourceFileName"/>
                                    </copy>
                                    <copy>
                                        <from variable="File_Name"/>
                                        <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:TargetFileName"/>
                                    </copy>
                                    <copy>
                                        <from variable="inputVariable" part="payload" query="/ns2:ProcessPDFFTPSalesForce/ns2:DataArea/ns6:PDFSalesForce/ns6:PDFSalesForceDetails/ns7:SourceDirectoryPath"/>
                                        <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:SourcePhysicalDirectory"/>
                                    </copy>
                                    <copy>
                                        <from expression="ora:getPreference(&quot;PostCastPath&quot;)"/>
                                        <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:TargetPhysicalDirectory"/>
                                    </copy>
                                </assign>
                                <invoke name="InvFTPFileMoveService" inputVariable="InvokeMovErrFTP_IV" outputVariable="InvokeMovErrFTP_OV" partnerLink="FTPFileMoveService" portType="ns16:FTPFileMoveService" operation="process" bpelx:invokeAsDetail="no" id="BpInv15"/>
                                <assign name="AssignSucessUpdDB" id="BpAss29">
                                    <copy>
                                        <from expression="'COMPLETED'"/>
                                        <to variable="UpdateFTPDetailsDB_IV" part="UpdateFTPDetailsDBInput_msg" query="/ns12:UpdateFTPDetailsDBInput/ns12:RECORD_STATUS"/>
                                    </copy>
                                    <copy>
                                        <from expression="'COMPLETED'"/>
                                        <to variable="UpdateFTPDetailsDB_IV" part="UpdateFTPDetailsDBInput_msg" query="/ns12:UpdateFTPDetailsDBInput/ns12:ERROR_MESSAGE"/>
                                    </copy>
                                    <copy>
                                        <from variable="File_Name"/>
                                        <to variable="UpdateFTPDetailsDB_IV" part="UpdateFTPDetailsDBInput_msg" query="/ns12:UpdateFTPDetailsDBInput/ns12:PDF_FILE_NAME"/>
                                    </copy>
                                </assign>
                                <invoke name="InvokeUpdDB" inputVariable="UpdateFTPDetailsDB_IV" partnerLink="UpdateFTPDetailsDB" portType="ns11:UpdateFTPDetailsDB_ptt" operation="UpdateFTPDetailsDB" bpelx:invokeAsDetail="no" id="BpInv16"/>
                            </sequence>
                        </case>
                        <otherwise>
                            <sequence name="Sequence7" id="BpSeq11">
                                <assign name="AssignErrFTP" id="BpAss30">
                                    <copy>
                                        <from variable="RenameFileName"/>
                                        <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:SourceFileName"/>
                                    </copy>
                                    <copy>
                                        <from variable="File_Name"/>
                                        <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:TargetFileName"/>
                                    </copy>
                                    <copy>
                                        <from variable="inputVariable" part="payload" query="/ns2:ProcessPDFFTPSalesForce/ns2:DataArea/ns6:PDFSalesForce/ns6:PDFSalesForceDetails/ns7:SourceDirectoryPath"/>
                                        <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:SourcePhysicalDirectory"/>
                                    </copy>
                                    <copy>
                                        <from expression="'/home/ftpaccount/errorFiles/failedUpdateSFDC'"/>
                                        <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:TargetPhysicalDirectory"/>
                                    </copy>
                                </assign>
                                <invoke name="InvFTPFileMoveService" inputVariable="InvokeMovErrFTP_IV" outputVariable="InvokeMovErrFTP_OV" partnerLink="FTPFileMoveService" portType="ns16:FTPFileMoveService" operation="process" bpelx:invokeAsDetail="no" id="BpInv17"/>
                                <assign name="AssignFailureUpdDB" id="BpAss31">
                                    <copy>
                                        <from variable="File_Name"/>
                                        <to variable="UpdateFTPDetailsDB_IV" part="UpdateFTPDetailsDBInput_msg" query="/ns12:UpdateFTPDetailsDBInput/ns12:PDF_FILE_NAME"/>
                                    </copy>
                                    <copy>
                                        <from expression="'ERROR'"/>
                                        <to variable="UpdateFTPDetailsDB_IV" part="UpdateFTPDetailsDBInput_msg" query="/ns12:UpdateFTPDetailsDBInput/ns12:RECORD_STATUS"/>
                                    </copy>
                                    <copy>
                                        <from expression="'Failed to update SOA in SFDC'"/>
                                        <to variable="UpdateFTPDetailsDB_IV" part="UpdateFTPDetailsDBInput_msg" query="/ns12:UpdateFTPDetailsDBInput/ns12:ERROR_MESSAGE"/>
                                    </copy>
                                </assign>
                                <invoke name="InvokeUpdDB" bpelx:invokeAsDetail="no" inputVariable="UpdateFTPDetailsDB_IV" partnerLink="UpdateFTPDetailsDB" portType="ns11:UpdateFTPDetailsDB_ptt" operation="UpdateFTPDetailsDB" id="BpInv18"/>
                            </sequence>
                        </otherwise>
                    </switch>
                </sequence>
            </case>
            <otherwise>
                <sequence name="Sequence1" id="BpSeq12">
                    <assign name="AssignMoveFtpData" id="BpAss32">
                        <copy>
                            <from variable="File_Name"/>
                            <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:TargetFileName"/>
                        </copy>
                        <copy>
                            <from variable="RenameFileName"/>
                            <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:SourceFileName"/>
                        </copy>
                        <copy>
                            <from variable="inputVariable" part="payload" query="/ns2:ProcessPDFFTPSalesForce/ns2:DataArea/ns6:PDFSalesForce/ns6:PDFSalesForceDetails/ns7:SourceDirectoryPath"/>
                            <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:SourcePhysicalDirectory"/>
                        </copy>
                        <copy>
                            <from expression="ora:getPreference(&quot;FailMissSFDCPath&quot;)"/>
                            <to variable="InvokeMovErrFTP_IV" part="payload" query="/ns17:FileMoveReq/ns17:TargetPhysicalDirectory"/>
                        </copy>
                    </assign>
                    <invoke name="InvokeErrFTP" partnerLink="FTPFileMoveService" portType="ns16:FTPFileMoveService" operation="process" inputVariable="InvokeMovErrFTP_IV" outputVariable="InvokeMovErrFTP_OV" bpelx:invokeAsDetail="no" id="BpInv19">
                        <bpelx:inputProperty name="jca.ftp.FileName" variable="File_Name"/>
                    </invoke>
                    <assign name="AssignUpdData" id="BpAss33">
                        <copy>
                            <from variable="File_Name"/>
                            <to variable="UpdateFTPDetailsDB_IV" part="UpdateFTPDetailsDBInput_msg" query="/ns12:UpdateFTPDetailsDBInput/ns12:PDF_FILE_NAME"/>
                        </copy>
                        <copy>
                            <from expression="'ERROR'"/>
                            <to variable="UpdateFTPDetailsDB_IV" part="UpdateFTPDetailsDBInput_msg" query="/ns12:UpdateFTPDetailsDBInput/ns12:RECORD_STATUS"/>
                        </copy>
                        <copy>
                            <from expression="'Cannot find SFDC account to match oracle account'"/>
                            <to variable="UpdateFTPDetailsDB_IV" part="UpdateFTPDetailsDBInput_msg" query="/ns12:UpdateFTPDetailsDBInput/ns12:ERROR_MESSAGE"/>
                        </copy>
                    </assign>
                    <invoke name="InvokeUpdDB" bpelx:invokeAsDetail="no" inputVariable="UpdateFTPDetailsDB_IV" partnerLink="UpdateFTPDetailsDB" portType="ns11:UpdateFTPDetailsDB_ptt" operation="UpdateFTPDetailsDB" id="BpInv20"/>
                </sequence>
            </otherwise>
        </switch>
        <!--     <switch name="Switch1">
            <case condition="bpws:getVariableData('IntCountofSFDCAccount') = 1">
                <sequence name="Sequence2">
                 <assign name="Assign1">
                        <copy>
                            <from variable="inputVariable" part="payload"
                                  query="/ns2:ProcessPDFFTPSalesForce/ns2:DataArea/ns6:PDFSalesForce/ns6:PDFSalesForceDetails/ns7:SFDC_ACCOUNT_ID"/>
                            <to variable="SFDC_ACCOUNT_ID"/>
                        </copy>
                        <copy>
                            <from variable="inputVariable" part="payload"
                                  query="/ns2:ProcessPDFFTPSalesForce/ns2:DataArea/ns6:PDFSalesForce/ns6:PDFSalesForceDetails/ns7:SFDC_USER_ID"/>
                            <to variable="SFDC_User_ID"/>
                        </copy>
                        <copy>
                            <from variable="inputVariable" part="payload"
                                  query="/ns2:ProcessPDFFTPSalesForce/ns2:DataArea/ns6:PDFSalesForce/ns6:PDFSalesForceDetails/ns7:PDF_FILE_NAME"/>
                            <to variable="File_Name"/>
                        </copy>
                       
                    </assign> 
                    <invoke name="Invoke" bpelx:invokeAsDetail="no"
                            inputVariable="InvSFDCQuery_InputVariable"
                            outputVariable="InvSFDCQuery_OutputVariable"
                            partnerLink="SFDCService" portType="ns3:Soap"
                            operation="query"
                            bpelx:inputHeaderVariable="Header"/>
                    <invoke name="InvokeGetFile"
                            partnerLink="GetFileFTP" bpelx:invokeAsDetail="no">
                        <bpelx:inputProperty name="jca.ftp.FileName"
                                             variable="File_Name"/>
                    </invoke>
                </sequence>
            </case>
            <otherwise>
                <sequence name="Sequence1">
                    <invoke name="InvokeErrFTP"
                            inputVariable="InvokeErrFTP_Put_InputVariable"
                            partnerLink="PutErrorFileToFTP"
                            portType="ns10:Put_ptt" operation="Put"
                            bpelx:invokeAsDetail="no">
                        <bpelx:inputProperty name="jca.ftp.FileName"
                                             variable="inputVariable"
                                             part="payload"
                                             query="/ns2:ProcessPDFFTPSalesForce/ns2:DataArea/ns6:PDFSalesForce/ns6:PDFSalesForceDetails/ns7:PDF_FILE_NAME"/>
                    </invoke>
                    <assign name="AssignUpdData">
                        <copy>
                            <from variable="inputVariable" part="payload"
                                  query="/ns2:ProcessPDFFTPSalesForce/ns2:DataArea/ns6:PDFSalesForce/ns6:PDFSalesForceDetails/ns7:PDF_FILE_NAME"/>
                            <to variable="UpdateFTPDetailsDB_IV"
                                part="UpdateFTPDetailsDBInput_msg"
                                query="/ns12:UpdateFTPDetailsDBInput/ns12:PDF_FILE_NAME"/>
                        </copy>
                        <copy>
                            <from expression="'ERROR'"/>
                            <to variable="UpdateFTPDetailsDB_IV"
                                part="UpdateFTPDetailsDBInput_msg"
                                query="/ns12:UpdateFTPDetailsDBInput/ns12:RECORD_STATUS"/>
                        </copy>
                        <copy>
                            <from expression="'Cannot find SFDC account to match oracle account'"/>
                            <to variable="UpdateFTPDetailsDB_IV"
                                part="UpdateFTPDetailsDBInput_msg"
                                query="/ns12:UpdateFTPDetailsDBInput/ns12:ERROR_MESSAGE"/>
                        </copy>
                    </assign>
                    <invoke name="InvokeUpdDB" bpelx:invokeAsDetail="no"
                            inputVariable="UpdateFTPDetailsDB_IV"
                            partnerLink="UpdateFTPDetailsDB"
                            portType="ns11:UpdateFTPDetailsDB_ptt"
                            operation="UpdateFTPDetailsDB"/>
                </sequence>
            </otherwise>
        </switch> -->
    </sequence>
</process>